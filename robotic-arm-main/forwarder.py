# forwarder.py
# ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô node ‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å pub.py (msg1) ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Topic ‡πÄ‡∏õ‡πá‡∏ô msg2
# ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡πá‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÉ‡∏´‡πâ sub.py ‡∏°‡∏≤‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πàTopic msg2

import zmq

# ‡∏™‡∏£‡πâ‡∏≤‡∏á context ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö socket
context = zmq.Context()

# ---------- ‡∏™‡πà‡∏ß‡∏ô Subscriber ----------
# ‡∏™‡∏£‡πâ‡∏≤‡∏á socket ‡πÅ‡∏ö‡∏ö SUB ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å pub.py
subscriber = context.socket(zmq.SUB)
subscriber.connect("tcp://127.0.0.1:5555")  # ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Publisher ‡∏ó‡∏µ‡πà‡∏û‡∏≠‡∏£‡πå‡∏ï 5555
subscriber.setsockopt_string(zmq.SUBSCRIBE, "msg1")  # ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ Topic msg1

# ---------- ‡∏™‡πà‡∏ß‡∏ô Publisher ----------
# ‡∏™‡∏£‡πâ‡∏≤‡∏á socket ‡πÅ‡∏ö‡∏ö PUB ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á sub.py
publisher = context.socket(zmq.PUB)
publisher.bind("tcp://*:5556")  # bind ‡∏û‡∏≠‡∏£‡πå‡∏ï‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ

while True:
    # ‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà Topic msg1 ‡∏à‡∏≤‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á
    received = subscriber.recv_string()  # ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "msg1 Hello from original publisher"

    # ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô topic ‡πÅ‡∏•‡∏∞‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
    topic, content = received.split(' ', 1)

    # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Topic ‡πÄ‡∏õ‡πá‡∏ô msg2 ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà
    new_topic = "msg2"
    new_message = f"{new_topic} {content}"

    print("üîÅ ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠:", new_message)
    publisher.send_string(new_message)
